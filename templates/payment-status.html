<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ödəniş Yoxlanılır...</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; background-color: #f4f6f8; text-align: center; }
        .container { padding: 40px; }
        h2 { color: #333; }
        p { color: #666; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <h2 id="status-title">Ödənişiniz yoxlanılır...</h2>
        <p id="status-message">Zəhmət olmasa gözləyin, təsdiq olunan kimi imtahana yönləndiriləcəksiniz.</p>
        <div id="spinner" class="spinner"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('custom_order_id');
            const examId = urlParams.get('examId');

            if (!orderId || !examId) {
                document.getElementById('status-title').textContent = 'Xəta';
                document.getElementById('status-message').textContent = 'Sifariş məlumatları tapılmadı.';
                document.getElementById('spinner').style.display = 'none';
                return;
            }

            let attempts = 0;
            const maxAttempts = 5; // 15 saniyə gözləsin

            const interval = setInterval(() => {
                fetch(`/api/check-order-status/${orderId}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'APPROVED') {
                            clearInterval(interval);
                            window.location.href = `exam-test.html?examId=${examId}`;
                        } else {
                            attempts++;
                            if (attempts >= maxAttempts) {
                                clearInterval(interval);
                                document.getElementById('status-title').textContent = 'Xəta Baş Verdi';
                                document.getElementById('status-message').textContent = 'Ödəniş təsdiqlənmədi. Zəhmət olmasa dəstək ilə əlaqə saxlayın.';
                                document.getElementById('spinner').style.display = 'none';
                            }
                        }
                    })
                    .catch(err => {
                        clearInterval(interval);
                        document.getElementById('status-title').textContent = 'Server Xətası';
                        document.getElementById('spinner').style.display = 'none';
                    });
            }, 3000); 
        });
    </script>
</body>
</html>